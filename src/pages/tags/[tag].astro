---
import BlogList from "@components/blog/list";
import Layout from "@layouts/Layout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const tags: Record<string, any> = {};
  const posts = await getCollection("blog");
  posts.forEach(({ data }) =>
    data.tags.forEach((tag: string) => (tags[tag] = true))
  );
  return Object.keys(tags).map((tag) => ({ params: { tag } }));
}

const tag = Astro.params.tag ?? "";
const page = (await getEntryBySlug("pages", "_blog")).data;
page.title = tag[0].toUpperCase() + tag.slice(1);
page.description = "";

const filteredPosts = await getCollection("blog", (post) =>
  post.data.tags.includes(tag)
);
---

<Layout title={page.title} seo={page.seo}>
  <BlogList page={page} posts={filteredPosts} />
</Layout>
